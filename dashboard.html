<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExSurvey - Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* General Body and Layout */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #f4f7f9;
            color: #333;
        }

        /* Top Header Styling */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: #ffffff;
            border-bottom: 1px solid #e0e0e0;
            position: relative;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .user-panel {
            display: flex;
            align-items: center;
        }
        .balance-info {
            display: flex;
            align-items: center;
            margin-right: 20px;
            font-weight: bold;
        }
        #balance-amount {
            margin-right: 5px;
            color: #28a745;
        }
        .toggle-btn {
            background: none;
            border: none;
            color: #007bff;
            cursor: pointer;
            text-decoration: underline;
            font-size: 0.9em;
        }
        .header-icons {
            display: flex;
            align-items: center;
        }
        .header-icons a {
            color: #333;
            margin-left: 15px;
            font-size: 1.2em;
            cursor: pointer;
        }
        .header-icons .notification-icon {
            position: relative;
        }
        .header-icons .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: red;
            color: white;
            font-size: 0.7em;
            border-radius: 50%;
            padding: 3px 6px;
        }
        
        /* Hamburger Menu Header & Page Title */
        .main-content-header {
            display: flex;
            align-items: center;
            padding: 10px 20px;
            background-color: #ffffff;
            border-bottom: 1px solid #e0e0e0;
            margin-bottom: 20px;
            position: relative;
        }
        .main-content-header .menu-icon {
            font-size: 1.5em;
            cursor: pointer;
            margin-right: 15px;
        }
        .main-content-header h2 {
            margin: 0;
        }

        /* Button Grid Styling */
        .main-content {
            flex-grow: 1;
            padding: 20px;
        }
        .button-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        .button-card {
            background-color: #007bff;
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            cursor: pointer;
        }
        .button-card:hover {
            transform: translateY(-5px);
        }
        .button-card a {
            color: white;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        /* Footer */
        .footer {
            background-color: #fff;
            padding: 20px;
            text-align: center;
            border-top: 1px solid #e0e0e0;
        }
        .footer-links {
            margin-bottom: 10px;
        }
        .footer-links a {
            color: #555;
            text-decoration: none;
            margin: 0 10px;
            font-size: 0.9em;
        }
        .social-icons {
            margin-top: 15px;
        }
        .social-icons a {
            color: #555;
            font-size: 1.5em;
            margin: 0 10px;
            transition: color 0.2s;
        }
        .social-icons a:hover {
            color: #007bff;
        }
        .copyright {
            margin-top: 20px;
            font-size: 0.8em;
            color: #777;
        }

        /* Hamburger Dropdown Menu */
        .menu-dropdown {
            display: none;
            position: absolute;
            top: 50px;
            left: 20px;
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 10px;
            z-index: 10;
            min-width: 200px;
        }
        .menu-dropdown.open {
            display: block;
        }
        .menu-dropdown-header {
            display: flex;
            justify-content: flex-end;
            padding-bottom: 10px;
        }
        .menu-dropdown-header .close-btn {
            background: none;
            border: none;
            color: #555;
            font-size: 1.5em;
            cursor: pointer;
        }
        .menu-dropdown ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .menu-dropdown ul li a {
            display: block;
            padding: 10px 15px;
            color: #333;
            text-decoration: none;
            border-radius: 5px;
        }
        .menu-dropdown ul li a:hover {
            background-color: #f0f0f0;
        }
        
        /* Notice Box */
        .notice-container {
            padding: 0 20px;
            margin-top: 20px;
        }
        .notice-container h3 {
            margin-top: 0;
            margin-bottom: 10px;
        }
        .notice-box {
            background-color: #fff;
            border-left: 5px solid #ffc107;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .notice-content {
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        /* Modal for Notifications */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            animation: fadeIn 0.3s;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 10px;
            position: relative;
            animation: slideIn 0.3s;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
        }
        .notification-item {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
        }
        .notification-item:last-child {
            border-bottom: none;
        }
        .notification-time {
            font-size: 0.8em;
            color: #888;
        }

        @keyframes fadeIn {
            from {opacity: 0;}
            to {opacity: 1;}
        }
        @keyframes slideIn {
            from {transform: translateY(-50px);}
            to {transform: translateY(0);}
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>ExSurvey</h1>
        <div class="user-panel">
            <div class="balance-info">
                <span>Balance:</span>
                <span id="balance-amount">Loading...</span>
                <button id="toggle-balance" class="toggle-btn">Hide</button>
            </div>
            <div class="header-icons">
                <a href="#" class="notification-icon" id="notification-bell">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notification-badge" style="display: none;">0</span>
                </a>
                <a href="profile.html" id="profile-icon-link"><i class="fas fa-user-circle"></i></a>
            </div>
        </div>
    </div>
    
    <div class="main-content-header">
        <i class="fas fa-bars menu-icon" id="hamburger-icon"></i>
        <h2>Dashboard</h2>
    </div>

    <div class="menu-dropdown" id="menu-dropdown">
        <div class="menu-dropdown-header">
            <button class="close-btn" id="close-menu-btn">&times;</button>
        </div>
        <ul>
            <li><a href="#">Find Work</a></li>
            <li><a href="#">Trx History</a></li>
            <li><a href="#">Buy/Sell History</a></li>
            <li><a href="#">Order History</a></li>
            <li><a href="#" id="logout-button">Logout</a></li>
        </ul>
    </div>

    <div class="main-content">
        <div class="button-grid">
            <div class="button-card"><a href="#">Button 1</a></div>
            <div class="button-card"><a href="#">Button 2</a></div>
            <div class="button-card"><a href="#">Button 3</a></div>
            <div class="button-card"><a href="#">Button 4</a></div>
            <div class="button-card"><a href="#">Button 5</a></div>
            <div class="button-card"><a href="#">Button 6</a></div>
            <div class="button-card"><a href="#">Button 7</a></div>
            <div class="button-card"><a href="#">Button 8</a></div>
        </div>

        <div class="notice-container">
            <h3>Notice: এখানে প্রতি দিনের কাজের আপডেড দেওয়া হয়।</h3>
            <div class="notice-box">
                <p id="dynamic-notice" class="notice-content">
                    Loading...
                </p>
            </div>
        </div>
    </div>

    <div id="notification-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Notifications</h2>
            <div id="notification-list">
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>Email: <a href="mailto:exsurveyteam@gmail.com">support@exsurvey.com</a></p>
        <div class="footer-links">
            <a href="privacy.html">Privacy Policy</a> |
            <a href="terms.html">Terms of Service</a>
            <a href="reffer.html">Our Referral Program</a>
        </div>
        <div class="social-icons">
            <a href="https://www.youtube.com/@ExSurvey"><i class="fab fa-youtube"></i></a>
            <a href="https://chat.whatsapp.com/KDm94eBzNHMHwJY04raNqA?mode=ems_copy_c"><i class="fab fa-whatsapp"></i></a>
            <a href="https://www.facebook.com/profile.php?id=61580025557448"><i class="fab fa-facebook"></i></a>
        </div>
        <div class="copyright">
            <p>&copy; 2024 ExSurvey. All Rights Reserved.</p>
        </div>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCHV1NpohSUeK8bSH46iVWG-6kVxRsyEYY",
            authDomain: "exsurvey-b53a1.firebaseapp.com",
            databaseURL: "https://exsurvey-b53a1-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "exsurvey-b53a1",
            storageBucket: "exsurvey-b53a1.firebasestorage.app",
            messagingSenderId: "878285842202",
            appId: "1:878285842202:web:b291c816a627b1fc762ea3",
            measurementId: "G-7NPWGLC44N"
        };
      
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();

        // DOM Elements
        const balanceAmount = document.getElementById('balance-amount');
        const toggleBtn = document.getElementById('toggle-balance');
        const hamburgerIcon = document.getElementById('hamburger-icon');
        const menuDropdown = document.getElementById('menu-dropdown');
        const closeMenuBtn = document.getElementById('close-menu-btn');
        const dynamicNotice = document.getElementById('dynamic-notice');
        const notificationBell = document.getElementById('notification-bell');
        const notificationModal = document.getElementById('notification-modal');
        const closeButton = document.querySelector('.modal-content .close-button');
        const notificationList = document.getElementById('notification-list');
        const notificationBadge = document.getElementById('notification-badge');
        const profileIconLink = document.getElementById('profile-icon-link');
        const logoutButton = document.getElementById('logout-button');
        
        // Initial balance display state
        let currentBalanceText = "Loading...";

        // --- Event Listeners ---
        
        // Toggle Balance
        toggleBtn.addEventListener('click', () => {
            if (balanceAmount.innerText === '******') {
                balanceAmount.innerText = currentBalanceText;
                toggleBtn.innerText = 'Hide';
            } else {
                currentBalanceText = balanceAmount.innerText;
                balanceAmount.innerText = '******';
                toggleBtn.innerText = 'Show';
            }
        });

        // Hamburger Menu
        hamburgerIcon.addEventListener('click', () => {
            menuDropdown.classList.toggle('open');
        });

        closeMenuBtn.addEventListener('click', () => {
            menuDropdown.classList.remove('open');
        });

        // Notification Modal
        notificationBell.onclick = function() {
            notificationModal.style.display = "block";
        }

        closeButton.onclick = function() {
            notificationModal.style.display = "none";
        }

        window.onclick = function(event) {
            if (event.target == notificationModal) {
                notificationModal.style.display = "none";
            }
        }

        // Logout
        logoutButton.addEventListener('click', (e) => {
            e.preventDefault();
            auth.signOut().then(() => {
                alert("You have been logged out successfully.");
                window.location.href = "login.html";
            }).catch((error) => {
                console.error("Logout Error:", error);
                alert("Error during logout: " + error.message);
            });
        });

        // --- Firebase Functions ---
        
        // This function will listen for the user's login state
        auth.onAuthStateChanged((user) => {
            if (user) {
                // User is logged in, now we can load user-specific data
                loadUserData(user.uid);
                loadNotifications();
                loadDynamicNotice();
                
                // Link to user's profile
                profileIconLink.href = `profile.html?uid=${user.uid}`; 

            } else {
                // No user is logged in. Redirect to login page.
                window.location.href = "login.html";
            }
        });

        // Load balance from Firebase using the user's unique UID
        function loadUserData(userId) {
            const userRef = database.ref('users/' + userId);
            
            userRef.on('value', (snapshot) => {
                const userData = snapshot.val();
                if (userData && userData.balance !== undefined) {
                    balanceAmount.innerText = `$${userData.balance.toFixed(2)}`;
                    currentBalanceText = balanceAmount.innerText;
                } else {
                    balanceAmount.innerText = `$0.00`;
                    currentBalanceText = balanceAmount.innerText;
                }
            });
        }

        // Load notifications from Firebase
        function loadNotifications() {
            const notificationsRef = database.ref('notifications').orderByChild('timestamp');
            
            notificationsRef.on('value', (snapshot) => {
                notificationList.innerHTML = '';
                let unreadCount = 0;
                
                snapshot.forEach((childSnapshot) => {
                    const notification = childSnapshot.val();
                    const notificationElement = document.createElement('div');
                    notificationElement.classList.add('notification-item');
                    
                    const notificationTime = new Date(notification.timestamp).toLocaleString('bn-BD', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    notificationElement.innerHTML = `
                        <p>${notification.message}</p>
                        <span class="notification-time">${notificationTime}</span>
                    `;
                    
                    if (!notification.read) {
                        unreadCount++;
                    }
                    
                    notificationList.prepend(notificationElement);
                });
                
                if (unreadCount > 0) {
                    notificationBadge.style.display = 'block';
                    notificationBadge.innerText = unreadCount;
                } else {
                    notificationBadge.style.display = 'none';
                }
            });
        }
        
        // Load dynamic notice from Firebase
        function loadDynamicNotice() {
            const noticeRef = database.ref('app_notice');
            noticeRef.on('value', (snapshot) => {
                const noticeText = snapshot.val();
                if (noticeText) {
                    dynamicNotice.innerText = noticeText;
                } else {
                    dynamicNotice.innerText = "আজকের জন্য কোনো আপডেট নেই। অনুগ্রহ করে পরে আবার দেখুন।";
                }
            });
        }

    </script>
</body>
</html>
